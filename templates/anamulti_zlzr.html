<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="Neon Admin Panel">
	<meta name="author" content="">
	
	<title>Log-Detector | 日志分析</title>


	<link rel="stylesheet" href="static/css/jquery-ui-1.10.3.custom.min.css">
	<link rel="stylesheet" href="static/css/entypo.css">
	<link rel="stylesheet" href="static/css/css.css">
	<link rel="stylesheet" href="static/css/bootstrap.css">
	<link rel="stylesheet" href="static/css/neon-core.css">
	<link rel="stylesheet" href="static/css/neon-theme.css">
	<link rel="stylesheet" href="static/css/neon-forms.css">
	<link rel="stylesheet" href="static/css/custom.css">

	<script src="static/js/jquery-1.11.0.min.js"></script>

	<!--[if lt IE 9]><script src="assets/js/ie8-responsive-file-warning.js"></script><![endif]-->

	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
		<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
	<![endif]-->


</head>
<body class="page-body" data-url="http://neon.dev">

<div class="page-container"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->

	<div class="sidebar-menu">


		<header class="logo-env">

			<!-- logo -->
			<div class="logo">
				<a href="index.html">
					<img src="static/picture/p0" width="120" alt="">
				</a>
			</div>

						<!-- logo collapse icon -->

			<div class="sidebar-collapse">
				<a href="#" class="sidebar-collapse-icon with-animation"><!-- add class "with-animation" if you want sidebar to have animation during expanding/collapsing transition -->
					<i class="entypo-menu"></i>
				</a>
			</div>



			<!-- open/close menu icon (do not remove if you want to enable menu on mobile devices) -->
			<div class="sidebar-mobile-menu visible-xs">
				<a href="#" class="with-animation"><!-- add class "with-animation" to support animation -->
					<i class="entypo-menu"></i>
				</a>
			</div>

		</header>



		<ul id="main-menu" class="">
			<!-- add class "multiple-expanded" to allow multiple submenus to open -->
			<!-- class "auto-inherit-active-class" will automatically add "active" class for parent elements who are marked already with class "active" -->
			<!-- Search Bar -->
			<li id="search">
				<form method="get" action="">
					<input type="text" name="q" class="search-input" placeholder="Search something...">
					<button type="submit">
						<i class="entypo-search"></i>
					</button>
				</form>
			</li>
                    <li>
						<a href="index.html">
							<span>返回主页</span>
						</a>
					</li>

					<li class="active">
						<a href="layout-mixed-menus.html">
							<span>上传文件</span>
						</a>
					</li>


					<li>
						<a href="skin-black.html">
							<span>异常检测</span>
						</a>
						<ul>
							<li>
								<a href="skin-black.html">
									<span>选择文件</span>
								</a>
								<a href="anadata.html">
									<span>日志分析</span>
								</a>
							</li>

                        </ul>
							<li>
								<a href="anamulti_zlzr.html">
									<span>结果分析</span>
								</a>
							</li>

					</li>

		</ul>

	</div>
<div class="main-content">
<hr>

<script type="text/javascript">
jQuery(document).ready(function($)
{


});


function getRandomInt(min, max)
{
	return Math.floor(Math.random() * (max - min + 1)) + min;
}
</script>
<div class="row">
	<div class="col-sm-12">
		<!-- <form id="form1" method="post" action=/monitor enctype="multipart/form-data"> -->
			<div class="well">
				<!--div class="dropdown"-->

				<h1 for="field-2" class="col-sm-12 control-label">详细结果查看：</h1>
				<h3 for="field-2" class="col-sm-12 control-label">请确保所选的原始日志文件与结果文件是对应的</h3>

                  <!-- 结构化日志文件下拉菜单 -->
            <div class="dropdown">
                <button type="button" class="btn dropdown-toggle btn-green" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    选择原始日志文件
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1" id="struct_log_menu">
                    <li role="presentation" class="dropdown-header">可选原始日志文件</li>
                    <!-- 动态添加的文件列表项将在这里显示 -->
                </ul>
            </div>

            <!-- 标签文件下拉菜单 -->
            <div class="dropdown">
                <button type="button" class="btn dropdown-toggle btn-green" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    选择对应结果预测文件
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu2" id="log_label_menu">
                    <li role="presentation" class="dropdown-header">可选预测文件</li>
                    <!-- 动态添加的文件列表项将在这里显示 -->
                </ul>
            </div>
				<button type="button" class="btn btn-info btn-icon" onclick="startAnalysis()">
					查看结果
					<i class="entypo-search"></i>
				</button>
                <input type="hidden" id="struct_log" name="struct_log">
                <input type="hidden" id="log_label" name="log_label">
			</div>
		<!-- </form> -->
	</div>
</div>
        <style>
        /* 设置滚动容器的样式 */
        #anomalies-container {
            max-height: 600px; /* 设置最大高度 */
            overflow-y: auto; /* 启用垂直滚动 */
            border: 1px solid #ccc; /* 边框 */
            padding: 10px;
            margin-top: 20px;
        }
    </style>
<!-- 异常日志条目展示区域 -->
        <div class="row" id="anomalies-container">
            <div class="col-sm-12">
                <h2>异常日志条目</h2>
                <div id="anomalies-output"></div>
            </div>
        </div>
    </div>
</div>
<script src="static/js/jquery-1.11.0.min.js"></script>

<script src="https://unpkg.com/bootstrap-table@1.13.4/dist/bootstrap-table.min.js"></script>
<script>
	$(document).ready(function() {

   var uploadfolder = "upload";
   $.ajax({
        url: "/get_filename",
        type: "GET",
        dataType: "json",  // 指定期望的数据类型为 JSON
        data: { folder: uploadfolder }, // 通过data属性传递文件夹名
         success: function(data) {
                console.log("上传文件夹中的文件列表:", data); // 添加调试信息
                var structLogMenu = $("#struct_log_menu");

                structLogMenu.empty();

                structLogMenu.append("<li role='presentation' class='dropdown-header'>可选原始日志文件</li>");

                data.forEach(function(filename) {
                    var html = "<li><a code='" + filename + "'>" + filename + "</a></li>";
                    structLogMenu.append(html);
                });

                 $("#struct_log_menu li a").click(function() {
                    GetChose($(this).attr('code'), 'struct_log');
                });
            },
            error: function() {
            console.log("获取上传文件夹文件列表时出错"); // 添加调试信息
                alert("无法获取文件列表");
            }
        });

    var resultsfolder = "results"; //
    $.ajax({
        url: "/get_filename",
        type: "GET",
        dataType: "json",  // 指定期望的数据类型为 JSON
        data: { folder: resultsfolder }, // 通过data属性传递文件夹名
         success: function(data) {
                console.log("结果文件夹中的文件列表:", data); // 添加调试信息
                var logLabelMenu = $("#log_label_menu");

                logLabelMenu.empty();

                logLabelMenu.append("<li role='presentation' class='dropdown-header'>可选结果预测文件</li>");

                data.forEach(function(filename) {
                    var html = "<li><a code='" + filename + "'>" + filename + "</a></li>";
                    logLabelMenu.append(html);
                });


                $("#log_label_menu li a").click(function() {
                    GetChose($(this).attr('code'), 'log_label');
                });

            },
            error: function() {
            console.log("获取结果文件夹文件列表时出错"); // 添加调试信息
                alert("无法获取文件列表");
            }
        });
    });
   // 假设这两个变量用于存储选择的文件名
var structLogFileName;
var logLabelFileName;

function GetChose(option, type) {
    console.log('选择的文件:', option);
    if (type === 'struct_log') {
        structLogFileName = option; // 存储结构化日志文件名
        $('#dropdownMenu1').html('选择原始日志文件：' + option + '<span class="caret"></span>');
    } else if (type === 'log_label') {
        logLabelFileName = option; // 存储标签文件名
        $('#dropdownMenu2').html('选择对应结果预测文件：' + option + '<span class="caret"></span>');
    }
}
function startAnalysis() {
    if (structLogFileName && logLabelFileName) {
        console.log("开始分析，使用的文件:", structLogFileName, logLabelFileName); // 添加调试信息
        // 这里点击查看结果后显示原始日志 CSV 文件中的异常条目
        $.ajax({
                    url: '/get-anomalies',
                    type: 'POST',
                    data: {
                        struct_log: structLogFileName,
                        log_label: logLabelFileName
                    },
                    success: function(data) {
                        console.log("获取到的异常数据:", data); // 添加调试信
                        var anomalies = data.anomalies;
                        var container = $('#anomalies-container');
                        container.empty(); // 清空容器
                        $.each(anomalies, function(i, entry) {
                            // 将每个异常日志条目添加到容器中
                            container.append('<p>' + JSON.stringify(entry) + '</p>');
                        });
                    },
                    error: function(err) {
                        console.log("获取异常数据时出错:", err); // 添加调试信
                    }
                });
    } else {
        alert('请选择原始日志文件和对应结果文件进行查看');
    }
}
</script>



<script type="text/javascript">
jQuery(document).ready(function($) 
{
	$('.inlinebar').sparkline('html', {type: 'bar', barColor: '#ff6264'} );
	$('.inlinebar-2').sparkline('html', {type: 'bar', barColor: '#445982'} );
	$('.inlinebar-3').sparkline('html', {type: 'bar', barColor: '#00b19d'} );
	$('.bar-2').sparkline([ [1,4], [2, 3], [3, 2], [4, 1] ], { type: 'bar' });
	$('.pie-2').sparkline('html', {type: 'pie',borderWidth: 0, sliceColors: ['#3d4554', '#ee4749','#00b19d']});
	$('.linechart').sparkline();


	$(".pie-large").sparkline([3,2,5], {
		type: 'pie',
		width: '150px ',
		height: '150px',
		sliceColors: ['#ee4749', '#c13638','#fe9193']
		
	});

	$(".line-large").sparkline([5,6,7,9,10,5,3,4,5,4,6,7, ], {
		type: 'line',
		width: '320px ',
		height: '150px',
		lineColor: '#ff4e50',
		highlightLineColor: '#ff8889',
		highlightSpotColor: '#b22425',
		minSpotColor: '#ff4e50',
		maxSpotColor: '#ff4e50',
		fillColor: '#f79696',
		lineWidth: 2,
		spotRadius: 4.5,
		normalRangeColor: '#ed4949'
	});


	$(".bar-large").sparkline([5,6,7,2,1,0,4,3,5,7,2,4], {
		type: 'bar',
		barColor: '#ff6264',
		height: '150px',
		barWidth: 10,
		barSpacing: 2
	});			
});
</script>


<br>
<	</div>
	
	
<div id="chat" class="fixed" data-current-user="Art Ramadani" data-order-by-status="1" data-max-chat-history="25">
	
	<div class="chat-inner">
	
		
		<h2 class="chat-header">
			<a href="#" class="chat-close" data-animate="1"><i class="entypo-cancel"></i></a>
			
			<i class="entypo-users"></i>
			Chat
			<span class="badge badge-success is-hidden">0</span>
		</h2>
		
		
		<div class="chat-group" id="group-1">
			<strong>Favorites</strong>
			
			<a href="#" id="sample-user-123" data-conversation-history="#sample_history"><span class="user-status is-online"></span> <em>Catherine J. Watkins</em></a>
			<a href="#"><span class="user-status is-online"></span> <em>Nicholas R. Walker</em></a>
			<a href="#"><span class="user-status is-busy"></span> <em>Susan J. Best</em></a>
			<a href="#"><span class="user-status is-offline"></span> <em>Brandon S. Young</em></a>
			<a href="#"><span class="user-status is-idle"></span> <em>Fernando G. Olson</em></a>
		</div>
		
		
		<div class="chat-group" id="group-2">
			<strong>Work</strong>
			
			<a href="#"><span class="user-status is-offline"></span> <em>Robert J. Garcia</em></a>
			<a href="#" data-conversation-history="#sample_history_2"><span class="user-status is-offline"></span> <em>Daniel A. Pena</em></a>
			<a href="#"><span class="user-status is-busy"></span> <em>Rodrigo E. Lozano</em></a>
		</div>
	
	</div>
	
	<!-- conversation template -->
	<div class="chat-conversation">
		
		<div class="conversation-header">
			<a href="#" class="conversation-close"><i class="entypo-cancel"></i></a>
			
			<span class="user-status"></span>
			<span class="display-name"></span> 
			<small></small>
		</div>
		
		<ul class="conversation-body">	
		</ul>
		
		<div class="chat-textarea">
			<textarea class="form-control autogrow" placeholder="Type your message"></textarea>
		</div>
		
	</div>
	
</div>


<!-- Chat Histories -->
<ul class="chat-history" id="sample_history">
	<li>
		<span class="user">Art Ramadani</span>
		<p>Are you here?</p>
		<span class="time">09:00</span>
	</li>
	
	<li class="opponent">
		<span class="user">Catherine J. Watkins</span>
		<p>This message is pre-queued.</p>
		<span class="time">09:25</span>
	</li>
	
	<li class="opponent">
		<span class="user">Catherine J. Watkins</span>
		<p>Whohoo!</p>
		<span class="time">09:26</span>
	</li>
	
	<li class="opponent unread">
		<span class="user">Catherine J. Watkins</span>
		<p>Do you like it?</p>
		<span class="time">09:27</span>
	</li>
</ul>




<!-- Chat Histories -->
<ul class="chat-history" id="sample_history_2">
	<li class="opponent unread">
		<span class="user">Daniel A. Pena</span>
		<p>I am going out.</p>
		<span class="time">08:21</span>
	</li>
	
	<li class="opponent unread">
		<span class="user">Daniel A. Pena</span>
		<p>Call me when you see this message.</p>
		<span class="time">08:27</span>
	</li>
</ul>	
	</div>



	<link rel="stylesheet" href="static/css/rickshaw.min.css">

	<!-- Bottom Scripts -->
	<script src="static/js/main-gsap.js"></script>
	<script src="static/js/jquery-ui-1.10.3.minimal.min.js"></script>
	<script src="static/js/bootstrap.js"></script>
	<script src="static/js/joinable.js"></script>
	<script src="static/js/resizeable.js"></script>
	<script src="static/js/neon-api.js"></script>
	<script src="static/js/d3.v3.js"></script>
	<script src="static/js/rickshaw.min.js"></script>
	<script src="static/js/raphael-min.js"></script>
	<script src="static/js/morris.min.js"></script>
	<script src="static/js/jquery.peity.min.js"></script>
	<script src="static/js/my-chartss.js"></script>
	<script src="static/js/jquery.sparkline.min.js"></script>
	<script src="static/js/neon-chat.js"></script>
	<script src="static/js/neon-custom.js"></script>
	<script src="static/js/neon-demo.js"></script>
	<script src="static/js/echarts.js"></script>

</body>
</html>